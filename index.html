<!doctype html>
<html lang="en" translate="no">
  <head>
    <!-- customize head -->
    <script defer src="https://cloud.umami.is/script.js" data-website-id="cd9b123a-76fb-4fa0-b054-0ea1cb687311"></script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="referrer" content="same-origin" />
    <meta name="generator" content="OpenList" />
    <meta name="theme-color" content="#000000" />
    <meta name="google" content="notranslate" />
    <link href="/manifest.json" rel="manifest" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-title" content="OpenList" />
    <link rel="apple-touch-icon" href="https://res.oplist.org/logo/logo.png" />
    <link
      rel="shortcut icon"
      type="image/ico"
      href="https://res.oplist.org/logo/logo.svg"
    />
   
<script>
  function addCustomHeaderButtons() {
    // --- 在这里配置你的按钮 ---
    const customButtons = [
      {
        text: "统计",
        url: "https://cloud.umami.is/share/aeemeFNV9rFq6STN", 
      },
      {
        text: "状态",
        url: "https://stats.uptimerobot.com/BxOAxgHqkh", 
      },
    ];
    // --- 配置结束 ---

    const referenceButton = document.querySelector('.hope-c-ivMHWx-hZistB-cv.hope-icon-button');
    if (!referenceButton || !referenceButton.parentElement) return;
    
    const nativeButtonsContainer = referenceButton.parentElement;
    const insertionPoint = nativeButtonsContainer.parentElement;
    if (!insertionPoint) return;

    if (document.getElementById('custom-header-buttons-wrapper')) return;

    const wrapper = document.createElement('div');
    wrapper.id = 'custom-header-buttons-wrapper';
    
    Object.assign(wrapper.style, {
      display: 'flex',
      alignItems: 'center',
      gap: '12px',
    });
    
    customButtons.forEach(buttonInfo => {
      const newButton = document.createElement('a');
      newButton.href = buttonInfo.url;
      newButton.textContent = buttonInfo.text;
      newButton.target = "_blank";
      newButton.rel = "noopener noreferrer";
      
      Object.assign(newButton.style, {
        display: 'inline-flex',
        alignItems: 'center',
        justifyContent: 'center',
        height: '36px',
        padding: '0 16px',
        borderRadius: '8px',
        fontSize: '14px',
        fontWeight: 'bold',
        textDecoration: 'none',
        transition: 'background-color 0.2s ease-in-out, color 0.2s ease-in-out',
        border: 'none',
        cursor: 'pointer',
        whiteSpace: 'nowrap'
      });
      
      const updateButtonColors = () => {
          const isDark = document.documentElement.classList.contains('hope-ui-dark');
          newButton.style.backgroundColor = 'transparent';
          newButton.style.color = isDark ? 'rgba(255, 255, 255, 0.8)' : 'rgba(0, 0, 0, 0.7)';
      };
      updateButtonColors();

      newButton.onmouseover = () => {
        const isDark = document.documentElement.classList.contains('hope-ui-dark');
        newButton.style.backgroundColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.08)';
        newButton.style.color = isDark ? 'rgba(255, 255, 255, 1)' : 'rgba(0, 0, 0, 1)';
      };
      newButton.onmouseout = updateButtonColors;

      wrapper.appendChild(newButton);
    });
    
    insertionPoint.insertBefore(wrapper, nativeButtonsContainer);
  }

  const checkInterval = setInterval(() => {
    if (document.querySelector('.hope-c-ivMHWx-hZistB-cv.hope-icon-button')) {
      addCustomHeaderButtons();
      clearInterval(checkInterval);
    }
  }, 150);
</script>
    <style>
      /* --- 全局背景图 (移除此处的背景模糊) --- */
      /* 白天背景图 */
      .hope-ui-light {
        background-image: url("https://t.alcy.cc/ycy") !important;
        background-repeat: no-repeat;
        background-size: cover;
        background-attachment: fixed;
        background-position-x: center;
        /* backdrop-filter: blur(3px);  <-- 已从此位置移除 */
      }
      /* 夜间背景图 */
      .hope-ui-dark {
        background-image:
          linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)),
          url("https://t.alcy.cc/ycy") !important;
        background-repeat: no-repeat;
        background-size: cover;
        background-attachment: fixed;
        background-position-x: center;
      }

      /* --- 主要UI面板玻璃效果 (新增或修正 backdrop-filter) --- */
      /* 定义一个通用的玻璃效果类 */
      .glass-effect-light {
        background-color: rgba(255, 255, 255, 0.5) !important;
        backdrop-filter: blur(5px) !important;
        -webkit-backdrop-filter: blur(5px) !important; /* 兼容Safari */
      }
      .glass-effect-dark {
        background-color: rgb(0 0 0 / 50%) !important;
        backdrop-filter: blur(5px) !important;
        -webkit-backdrop-filter: blur(5px) !important; /* 兼容Safari */
      }
      
      /* 将效果应用到具体元素 */
      /* 主列表 */
      .hope-ui-light .obj-box.hope-stack.hope-c-dhzjXW.hope-c-PJLV.hope-c-PJLV-igScBhH-css {
        background-color: rgba(255, 255, 255, 0.5) !important;
        backdrop-filter: blur(5px) !important;
      }
      .hope-ui-dark .obj-box.hope-stack.hope-c-dhzjXW.hope-c-PJLV.hope-c-PJLV-iigjoxS-css {
        background-color: rgb(0 0 0 / 50%) !important;
        backdrop-filter: blur(5px) !important;
      }
      /* README区域 */
      .hope-ui-light .hope-c-PJLV.hope-c-PJLV-ikSuVsl-css {
        background-color: rgba(255, 255, 255, 0.5) !important;
        backdrop-filter: blur(5px) !important;
      }
      .hope-ui-dark .hope-c-PJLV.hope-c-PJLV-iiuDLME-css {
        background-color: rgb(0 0 0 / 50%) !important;
        backdrop-filter: blur(5px) !important;
      }
      /* 左侧侧边栏 */
      .hope-ui-light .hope-c-PJLV-ieGWMbI-css {
        background: rgba(255, 255, 255, 0.3) !important;
        backdrop-filter: blur(5px) !important;
      }
      .hope-ui-dark .hope-c-PJLV-ieGWMbI-css {
        background-color: rgb(0 0 0 / 50%) !important;
        backdrop-filter: blur(5px) !important;
      }
      /* 正常情况下的导航条 */
      .hope-ui-light .hope-c-PJLV-idaeksS-css {
        background-color: rgba(255, 255, 255, 0.5) !important;
        backdrop-filter: blur(5px) !important;
        border-radius: 10px !important;
      }
      .hope-ui-dark .hope-c-PJLV-idaeksS-css {
        background-color: rgb(0 0 0 / 50%) !important;
        backdrop-filter: blur(5px) !important;
        border-radius: 10px !important;
      }
      /* 滚动时吸顶的导航条 */
      .hope-ui-light .hope-c-PJLV-icKsjdm-css,
      .hope-ui-light .hope-c-hrsMRY {
        background-color: rgba(255, 255, 255, 0.5) !important;
        backdrop-filter: blur(5px) !important;
        border-radius: 10px !important;
      }
      .hope-ui-dark .hope-c-PJLV-icKsjdm-css,
      .hope-ui-dark .hope-c-hrsMRY {
        background-color: rgb(0 0 0 / 50%) !important;
        backdrop-filter: blur(5px) !important;
        border-radius: 10px !important;
      }

      /* --- 其他UI元素透明度调整 --- */
      /* 完全透明的顶栏容器，让导航条的模糊效果透出来 */
      .hope-c-PJLV-ikaMhsQ-css,
      .hope-c-PJLV-icWrYmg-css {
        background: transparent !important;
      }
      /* 移除导航条吸顶时的伪元素阴影 */
      .hope-c-PJLV-icKsjdm-css::after,
      .hope-c-PJLV-ifdXShc-css::after {
        background: transparent !important;
      }

      /* 右上角按钮 */
      .hope-ui-light .hope-c-ivMHWx-hZistB-cv.hope-icon-button { background-color: rgba(255, 255, 255, 0.3) !important; }
      .hope-ui-dark .hope-c-ivMHWx-hZistB-cv.hope-icon-button { background-color: rgb(0 0 0 / 10%) !important; }

      /* 右下角工具栏按钮 */
      .hope-ui-light .hope-c-PJLV-ijgzmFG-css { background-color: rgba(255, 255, 255, 0.5) !important; }
      .hope-ui-dark .hope-c-PJLV-ijgzmFG-css { background-color: rgb(0 0 0 / 50%) !important; }

      /* 返回顶部按钮 */
      .hope-ui-light .hope-c-PJLV-ihVEsOa-css { background: rgba(255, 255, 255, 0.3) !important; }
      .hope-ui-dark .hope-c-PJLV-ihVEsOa-css { background-color: rgb(0 0 0 / 50%) !important; }

      /* 代码块 */
      .hope-ui-light pre { background-color: rgba(255, 255, 255, 0.1) !important; }
      .hope-ui-dark pre { background-color: transparent !important; }

      /* --- 搜索框玻璃效果 (这个之前已经有了, 保持即可) --- */
      .hope-ui-light .hope-c-PJLV-iiBaxsN-css,
      .hope-ui-light .hope-c-kvTTWD-hYRNAb-variant-filled,
      .hope-ui-light .hope-c-PJLV-ikEIIxw-css {
        background-color: rgba(255, 255, 255, 0.2) !important;
        backdrop-filter: blur(10px) !important;
      }
      .hope-ui-dark .hope-c-PJLV-iiBaxsN-css,
      .hope-ui-dark .hope-c-kvTTWD-hYRNAb-variant-filled,
      .hope-ui-dark .hope-c-PJLV-ikEIIxw-css {
        background-color: rgb(0 0 0 / 10%) !important;
        backdrop-filter: blur(10px) !important;
      }
      .hope-ui-light .hope-c-PJLV-ikEIIxw-css,
      .hope-ui-dark .hope-c-PJLV-ikEIIxw-css {
         padding: var(--hope-space-1) !important;
      }
      
      /* --- 全局字体与布局 --- */
      * {
        font-family: LXGW WenKai;
        font-weight: bold;
      }
      body { font-family: LXGW WenKai; }
      .name-box.name { white-space: unset !important; overflow: unset !important; }
      .left-toolbar-box, .hope-close-button { display: none !important; }

      /* --- 数据中心徽章容器样式 --- */
      .custom-footer-badges {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
        gap: 10px;
        padding: 20px 15px;
        margin: 20px auto;
        max-width: 90%;
        width: fit-content;
        min-width: 300px;
        border-radius: 12px;
        transition: background-color 0.3s ease;
      }
      .hope-ui-light .custom-footer-badges {
        background-color: rgba(255, 255, 255, 0.5);
        backdrop-filter: blur(5px);
      }
      .hope-ui-dark .custom-footer-badges {
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
      }
    </style>
    <title>Loading...</title>
    <script>
      window.OPENLIST_CONFIG = {
        cdn: undefined, base_path: undefined, api: undefined, main_color: undefined,
      }
      window.__dynamic_base__ = window.OPENLIST_CONFIG.cdn || ""
    </script>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>

    <!-- 延迟加载的自定义内容 (可选) -->
    <div id="customize" style="display: none"></div>
    <script>
      let custInterval = setInterval(() => {
        if (document.querySelector(".footer")) {
          document.querySelector("#customize").style.display = "";
          clearInterval(custInterval);
        }
      }, 200);
    </script>

    <script src="/src/main.tsx" type="module"></script>
    
    <!-- START: 数据中心徽章注入脚本 -->
    <script>
      (function() {
        // --- SVG徽章生成器 (根据文本内容动态计算宽度) ---
        const getTextWidth = (text, font = "bold 11px Verdana,Geneva,DejaVu Sans,sans-serif") => {
            const canvas = getTextWidth.canvas || (getTextWidth.canvas = document.createElement("canvas"));
            const context = canvas.getContext("2d");
            context.font = font;
            return context.measureText(text).width + 5;
        };

        const createBadgeSVG = (label, value, valueColor = '#4c1') => {
            const labelColor = '#555';
            const paddingX = 14;
            const labelWidth = Math.round(getTextWidth(label)) + paddingX;
            const valueWidth = Math.round(getTextWidth(value)) + paddingX;
            const totalWidth = labelWidth + valueWidth;

            return `
              <svg xmlns="http://www.w3.org/2000/svg" width="${totalWidth}" height="20" role="img" aria-label="${label}: ${value}">
                <title>${label}: ${value}</title>
                <linearGradient id="s" x2="0" y2="100%"><stop offset="0" stop-color="#bbb" stop-opacity=".1"/><stop offset="1" stop-opacity=".1"/></linearGradient>
                <clipPath id="r"><rect width="${totalWidth}" height="20" rx="3" fill="#fff"/></clipPath>
                <g clip-path="url(#r)">
                  <rect width="${labelWidth}" height="20" fill="${labelColor}"/>
                  <rect x="${labelWidth}" width="${valueWidth}" height="20" fill="${valueColor}"/>
                  <rect width="${totalWidth}" height="20" fill="url(#s)"/>
                </g>
                <g fill="#fff" text-anchor="middle" font-family="Verdana,Geneva,DejaVu Sans,sans-serif" font-weight="bold" text-rendering="geometricPrecision" font-size="11">
                  <text x="${labelWidth / 2}" y="15" fill="#010101" fill-opacity=".3">${label}</text>
                  <text x="${labelWidth / 2}" y="14">${label}</text>
                  <text x="${labelWidth + valueWidth / 2}" y="15" fill="#010101" fill-opacity=".3">${value}</text>
                  <text x="${labelWidth + valueWidth / 2}" y="14">${value}</text>
                </g>
              </svg>`;
        };

        // --- 异步获取数据并更新徽章 ---
        const parseColo = (traceText) => {
          const line = traceText.split('\n').find(line => line.startsWith('colo='));
          return line ? line.split('=')[1] : null;
        };
    
        const fetchBadgeInfo = async (siteLabel, domain, badgeContainerEl) => {
          badgeContainerEl.innerHTML = createBadgeSVG(siteLabel, '查询中...', '#9f9f9f');
          try {
            const traceResponse = await fetch(`https://${domain}/cdn-cgi/trace`);
            if (!traceResponse.ok) throw new Error('Trace fetch failed');
            const traceText = await traceResponse.text();
            const colo = parseColo(traceText);
    
            if (colo) {
              let location = '未知';
              try {
                const locResponse = await fetch(`https://iata.isteed.cc/zh/${colo}`);
                if (locResponse.ok) location = await locResponse.text() || '未知';
              } catch (locError) {
                console.error(`Error fetching location for ${colo}:`, locError);
                location = '查询失败';
              }
              badgeContainerEl.innerHTML = createBadgeSVG(siteLabel, `${colo} ${location}`, '#4c1');
            } else {
              throw new Error('Colo not found');
            }
          } catch (error) {
            console.error(`Error fetching data for ${domain}:`, error);
            badgeContainerEl.innerHTML = createBadgeSVG(siteLabel, '获取失败', '#e05d44');
          }
        };
    
        // --- 主逻辑：等待页脚出现，然后注入徽章容器 ---
        const observer = new MutationObserver((mutations, obs) => {
          const originalFooter = document.querySelector(".footer");
          if (originalFooter && !document.querySelector('.custom-footer-badges')) {
            
            const sites = [
              { label: 'Main Site', domain: 'oplist.022928.xyz' },
              { label: 'Main API', domain: 'oplist-api.022928.xyz' },
              { label: 'R2 Storage', domain: 'fast-r2.022928.xyz' }
            ];

            const badgeContainer = document.createElement('div');
            badgeContainer.className = 'custom-footer-badges';

            originalFooter.parentNode.insertBefore(badgeContainer, originalFooter);
            
            sites.forEach((site) => {
              const span = document.createElement('span');
              badgeContainer.appendChild(span);
              fetchBadgeInfo(site.label, site.domain, span);
            });

            obs.disconnect();
          }
        });
    
        observer.observe(document.body, {
          childList: true,
          subtree: true
        });
      })();
    </script>
    <!-- END: 脚本结束 -->
  </body>
</html>
