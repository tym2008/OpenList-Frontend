<!doctype html>
<html lang="en" translate="no">
  <head>
    <!-- customize head -->
    <script defer src="https://cloud.umami.is/script.js" data-website-id="cd9b123a-76fb-4fa0-b054-0ea1cb687311"></script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="referrer" content="same-origin" />
    <meta name="generator" content="OpenList" />
    <meta name="theme-color" content="#000000" />
    <meta name="google" content="notranslate" />
    <link href="/manifest.json" rel="manifest" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-title" content="OpenList" />
    <link rel="apple-touch-icon" href="https://res.oplist.org/logo/logo.png" />
    <link
      rel="shortcut icon"
      type="image/ico"
      href="https://res.oplist.org/logo/logo.svg"
    />
   
<script>
  function addCustomHeaderButtons() {
    // --- 在这里配置你的按钮 ---
    const customButtons = [
      {
        text: "统计",
        url: "https://cloud.umami.is/share/aeemeFNV9rFq6STN", 
      },
      {
        text: "状态",
        url: "https://stats.uptimerobot.com/BxOAxgHqkh", 
      },
    ];
    // --- 配置结束 ---

    // 1. 寻找参考点：从右上角的图标按钮开始
    const referenceButton = document.querySelector('.hope-c-ivMHWx-hZistB-cv.hope-icon-button');

    // 确保参考点和它的父级都存在
    if (!referenceButton || !referenceButton.parentElement) {
      return;
    }
    
    // 这是原生按钮（主题切换等）所在的容器
    const nativeButtonsContainer = referenceButton.parentElement;
    
    // 这才是我们真正需要进行插入操作的父节点！
    const insertionPoint = nativeButtonsContainer.parentElement;

    // 如果找不到这个真正的父节点，也退出
    if (!insertionPoint) {
        return;
    }

    // 2. 防止重复添加
    if (document.getElementById('custom-header-buttons-wrapper')) {
      return;
    }

    // 3. 创建包裹我们按钮的容器
    const wrapper = document.createElement('div');
    wrapper.id = 'custom-header-buttons-wrapper';
    
    // 4. 设置容器样式
    Object.assign(wrapper.style, {
      display: 'flex',
      alignItems: 'center',
      gap: '12px',
    });
    
    // 5. 循环创建按钮
    customButtons.forEach(buttonInfo => {
      const newButton = document.createElement('a');
      newButton.href = buttonInfo.url;
      newButton.textContent = buttonInfo.text;
      newButton.target = "_blank";
      newButton.rel = "noopener noreferrer";
      
      Object.assign(newButton.style, {
        display: 'inline-flex',
        alignItems: 'center',
        justifyContent: 'center',
        height: '36px',
        padding: '0 16px',
        borderRadius: '8px',
        fontSize: '14px',
        fontWeight: 'bold',
        textDecoration: 'none',
        transition: 'background-color 0.2s ease-in-out, color 0.2s ease-in-out',
        border: 'none',
        cursor: 'pointer',
        whiteSpace: 'nowrap'
      });
      
      const updateButtonColors = () => {
          if (document.documentElement.classList.contains('hope-ui-dark')) {
              newButton.style.backgroundColor = 'transparent';
              newButton.style.color = 'rgba(255, 255, 255, 0.8)';
          } else {
              newButton.style.backgroundColor = 'transparent';
              newButton.style.color = 'rgba(0, 0, 0, 0.7)';
          }
      };
      updateButtonColors();

      newButton.onmouseover = () => {
        if (document.documentElement.classList.contains('hope-ui-dark')) {
          newButton.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
          newButton.style.color = 'rgba(255, 255, 255, 1)';
        } else {
          newButton.style.backgroundColor = 'rgba(0, 0, 0, 0.08)';
           newButton.style.color = 'rgba(0, 0, 0, 1)';
        }
      };
      newButton.onmouseout = updateButtonColors;

      wrapper.appendChild(newButton);
    });
    
    // 6. 核心修正：在正确的父节点上执行插入操作
    insertionPoint.insertBefore(wrapper, nativeButtonsContainer);
  }

  // 轮询检查机制保持不变
  const checkInterval = setInterval(() => {
    if (document.querySelector('.hope-c-ivMHWx-hZistB-cv.hope-icon-button')) {
      addCustomHeaderButtons();
      clearInterval(checkInterval);
    }
  }, 150);
</script>
    <style>
      /*白天背景图*/
      .hope-ui-light {
        background-image: url("https://t.alcy.cc/ycy") !important;
        background-repeat: no-repeat;
        background-size: cover;
        background-attachment: fixed;
        background-position-x: center;
        backdrop-filter: blur(3px);
      }
      /*夜间背景图*/
      .hope-ui-dark {
        background-image:
          linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)),
          url("https://t.alcy.cc/ycy") !important;
        background-repeat: no-repeat;
        background-size: cover;
        background-attachment: fixed;
        background-position-x: center;
      }
      /*主列表白天模式透明*/
      .obj-box.hope-stack.hope-c-dhzjXW.hope-c-PJLV.hope-c-PJLV-igScBhH-css {
        background-color: rgba(255, 255, 255, 0.5) !important;
      }
      /*主列表夜间模式透明*/
      .obj-box.hope-stack.hope-c-dhzjXW.hope-c-PJLV.hope-c-PJLV-iigjoxS-css {
        background-color: rgb(0 0 0 / 50%) !important;
      }
      /*readme白天模式透明*/
      .hope-c-PJLV.hope-c-PJLV-ikSuVsl-css {
        background-color: rgba(255, 255, 255, 0.5) !important;
      }
      /*readme夜间模式透明*/
      .hope-c-PJLV.hope-c-PJLV-iiuDLME-css {
        background-color: rgb(0 0 0 / 50%) !important;
      }
      /*顶部右上角切换按钮透明*/
      .hope-ui-light .hope-c-ivMHWx-hZistB-cv.hope-icon-button {
        background-color: rgba(255, 255, 255, 0.3) !important;
      }
      .hope-ui-dark .hope-c-ivMHWx-hZistB-cv.hope-icon-button {
        background-color: rgb(0 0 0 / 10%) !important;
      }
      /*右下角侧边栏按钮透明 第一个是白天 第二个是夜间*/
      .hope-ui-light .hope-c-PJLV-ijgzmFG-css {
        background-color: rgba(255, 255, 255, 0.5) !important;
      }
      .hope-ui-dark .hope-c-PJLV-ijgzmFG-css {
        background-color: rgb(0 0 0 / 50%) !important;
      }
      /*白天模式代码块透明*/
      .hope-ui-light pre {
        background-color: rgba(255, 255, 255, 0.1) !important;
      }
      /*夜间模式代码块透明*/
      .hope-ui-dark pre {
        background-color: rgba(255, 255, 255, 0) !important;
      }
      /*左侧侧边栏目录*/
      /*白天模式*/
      .hope-ui-light .hope-c-PJLV-ieGWMbI-css {
        background: rgba(255, 255, 255, 0.3) !important;
      }
      /*夜间模式*/
      .hope-ui-dark .hope-c-PJLV-ieGWMbI-css {
        background-color: rgb(0 0 0 / 50%) !important;
      }
      /* 返回顶部 */
      .hope-c-PJLV-ihVEsOa-css {
        background: rgba(255, 255, 255, 0.3) !important;
      }
      .hope-ui-dark .hope-c-PJLV-ihVEsOa-css {
        background-color: rgb(0 0 0 / 50%) !important;
      }
      /*正常情况未使用吸附功能*/
      /*导航条*/
      /*白天模式*/
      .hope-ui-light .hope-c-PJLV-idaeksS-css {
        background-color: rgba(255, 255, 255, 0.5) !important;
        border-radius: 10px !important;
      }
      /*夜间模式*/
      .hope-ui-dark .hope-c-PJLV-idaeksS-css {
        background-color: rgb(0 0 0 / 50%) !important;
        border-radius: 10px !important;
      }
      /*顶栏*/
      .hope-c-PJLV-ikaMhsQ-css {
        background: rgba(255, 255, 255, 0) !important;
      }
      /*白天模式 搜索主体+毛玻璃*/
      .hope-ui-light .hope-c-PJLV-iiBaxsN-css {
        background-color: rgba(255, 255, 255, 0.2) !important;
        backdrop-filter: blur(10px) !important;
      }
      /*白天模式 搜索栏输入框+毛玻璃*/
      .hope-ui-light .hope-c-kvTTWD-hYRNAb-variant-filled {
        background-color: rgba(255, 255, 255, 0.2) !important;
        backdrop-filter: blur(10px) !important;
      }
      /*白天模式 搜索按钮+毛玻璃*/
      .hope-ui-light .hope-c-PJLV-ikEIIxw-css {
        background-color: rgba(255, 255, 255, 0.2) !important;
        backdrop-filter: blur(10px) !important;
        padding: var(--hope-space-1) !important;
      }
      /*夜间模式搜索主体+毛玻璃*/
      .hope-ui-dark .hope-c-PJLV-iiBaxsN-css {
        background-color: rgb(0 0 0 / 10%) !important;
        backdrop-filter: blur(10px) !important;
      }
      /*夜间模式搜索栏+毛玻璃*/
      .hope-ui-dark .hope-c-kvTTWD-hYRNAb-variant-filled {
        background-color: rgb(0 0 0 / 10%) !important;
        backdrop-filter: blur(10px) !important;
      }
      /*夜间模式 搜索按钮+毛玻璃*/
      .hope-ui-dark .hope-c-PJLV-ikEIIxw-css {
        background-color: rgb(0 0 0 / 10%) !important;
        backdrop-filter: blur(10px) !important;
        padding: var(--hope-space-1) !important;
      }
      /* 吸附到页面顶部 */
      /*顶部*/
      .hope-c-PJLV-icWrYmg-css {
        background: rgba(255, 255, 255, 0) !important;
      }
      /*导航条*/
      .hope-c-PJLV-icKsjdm-css::after {
        background: rgba(255, 255, 255, 0) !important;
      }
      /*白天模式*/
      .hope-ui-light .hope-c-PJLV-icKsjdm-css {
        background-color: rgba(255, 255, 255, 0.5) !important;
        border-radius: 10px !important;
      }
      /*夜间模式*/
      .hope-ui-dark .hope-c-PJLV-icKsjdm-css {
        background-color: rgb(0 0 0 / 50%) !important;
        border-radius: 10px !important;
      }
      /*仅吸附导航栏*/
      /*导航条*/
      .hope-c-PJLV-ifdXShc-css::after {
        background: rgba(255, 255, 255, 0) !important;
      }
      /*白天模式*/
      .hope-ui-light .hope-c-hrsMRY {
        background-color: rgba(255, 255, 255, 0.5) !important;
        border-radius: 10px !important;
      }
      /*夜间模式*/
      .hope-ui-dark .hope-c-hrsMRY {
        background-color: rgb(0 0 0 / 50%) !important;
        border-radius: 10px !important;
      }
      /*底部CSS，.App .table这三个一起的*/
      dibu {
        border-top: 0px;
        position: absolute;
        bottom: 0;
        width: 100%;
        margin: 0px;
        padding: 0px;
      }
      .App {
        min-height: 85vh;
      }
      .table {
        margin: auto;
      }
      /*全局字体*/
      * {
        font-family: LXGW WenKai;
      }
      * {
        font-weight: bold;
      }
      body {
        font-family: LXGW WenKai;
      }
      /*渐变背景CSS*/
      #canvas-basic {
        position: fixed;
        display: block;
        width: 100%;
        height: 100%;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        z-index: -999;
      }
      /* 隐藏 通知栏的X */
      .hope-close-button {
        display: none !important;
      }
      /* 隐藏 右下角 */
      .left-toolbar-box {
        display: none;
      }
      /* 文字超长自动换行 */
      .name-box.name {
        white-space: unset !important;
        overflow: unset !important;
      }
    </style>
    <title>Loading...</title>
    <script>
      window.OPENLIST_CONFIG = {
        cdn: undefined,
        base_path: undefined,
        api: undefined,
        main_color: undefined,
      }
      window.__dynamic_base__ = window.OPENLIST_CONFIG.cdn || ""
    </script>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <!--延迟加载-->
    <div id="customize" style="display: none">
      <div><br /></div>
    </div>
    <!--延迟加载配套使用JS-->
    <script>
      let interval = setInterval(() => {
        if (document.querySelector(".footer")) {
          document.querySelector("#customize").style.display = ""
          clearInterval(interval)
        }
      }, 200)
    </script>

    <!-- 渐变背景初始化 -->
    <!--<canvas id="canvas-basic"></canvas> -->
    <!--<script async src="https://npm.elemecdn.com/granim@2.0.0/dist/granim.min.js"></script>-->
    <script>
      var granimInstance = new Granim({
        element: "#canvas-basic",
        direction: "left-right",
        isPausedWhenNotInView: true,
        states: {
          "default-state": {
            gradients: [
              ["#a18cd1", "#fbc2eb"], ["#fff1eb", "#ace0f9"],
              ["#d4fc79", "#96e6a1"], ["#a1c4fd", "#c2e9fb"],
              ["#a8edea", "#fed6e3"], ["#9890e3", "#b1f4cf"],
            ],
          },
        },
      })
    </script>

    <script src="/src/main.tsx" type="module"></script>
    <!-- customize body -->

    <!-- START: 为数据中心信息添加的代码 -->
    <template id="datacenter-template">
      <div id="datacenter-info">
        <h4>数据中心</h4>
        <table id="datacenter-info-table">
            <thead>
                <tr>
                    <th>服务</th>
                    <th>CF Colo</th>
                    <th>位置</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Main Site (oplist.022928.xyz)</td>
                    <td id="main-site-colo"></td>
                    <td id="main-site-loc"></td>
                </tr>
                <tr>
                    <td>R2 Storage (fast-r2.022928.xyz)</td>
                    <td id="r2-storage-colo"></td>
                    <td id="r2-storage-loc"></td>
                </tr>
            </tbody>
        </table>
      </div>
    </template>
    
    <style>
      #datacenter-info {
        text-align: center;
        padding: 20px 10px 40px 10px;
        font-size: 14px;
        clear: both;
      }
      #datacenter-info-table {
        margin: 10px auto 0;
        border-collapse: collapse;
        width: 90%;
        max-width: 600px;
        background-color: transparent;
        border-radius: 8px;
        overflow: hidden; 
      }
      #datacenter-info-table th, 
      #datacenter-info-table td {
        padding: 8px;
        border: 1px solid;
        vertical-align: middle;
      }
      #datacenter-info-table th {
        font-weight: bold;
      }
    
      /* 浅色模式 */
      .hope-ui-light #datacenter-info { color: rgba(0, 0, 0, 0.7); }
      .hope-ui-light #datacenter-info-table th,
      .hope-ui-light #datacenter-info-table td { border-color: rgba(0, 0, 0, 0.15); }
      .hope-ui-light #datacenter-info-table thead { background-color: rgba(255, 255, 255, 0.3); }
    
      /* 深色模式 */
      .hope-ui-dark #datacenter-info { color: rgba(255, 255, 255, 0.8); }
      .hope-ui-dark #datacenter-info-table th,
      .hope-ui-dark #datacenter-info-table td { border-color: rgba(255, 255, 255, 0.2); }
      .hope-ui-dark #datacenter-info-table thead { background-color: rgba(0, 0, 0, 0.2); }
    </style>
    
    <script>
      (function() {
        // --- SVG徽章生成器 ---

        // 辅助函数：精确测量文本宽度
        const getTextWidth = (text, font = "11px Verdana,Geneva,DejaVu Sans,sans-serif") => {
            const canvas = getTextWidth.canvas || (getTextWidth.canvas = document.createElement("canvas"));
            const context = canvas.getContext("2d");
            context.font = font;
            const metrics = context.measureText(text);
            return metrics.width;
        };

        // 主函数：创建SVG徽章
        const createBadgeSVG = (label, value, labelColor = '#555', valueColor = '#9b90c2') => {
            const paddingX = 10;
            const labelWidth = Math.round(getTextWidth(label)) + paddingX;
            const valueWidth = Math.round(getTextWidth(value)) + paddingX;
            const totalWidth = labelWidth + valueWidth;

            // 使用模板字符串构建SVG
            return `
              <svg xmlns="http://www.w3.org/2000/svg" width="${totalWidth}" height="20" role="img" aria-label="${label}: ${value}">
                <title>${label}: ${value}</title>
                <linearGradient id="s" x2="0" y2="100%">
                  <stop offset="0" stop-color="#bbb" stop-opacity=".1"/>
                  <stop offset="1" stop-opacity=".1"/>
                </linearGradient>
                <clipPath id="r">
                  <rect width="${totalWidth}" height="20" rx="3" fill="#fff"/>
                </clipPath>
                <g clip-path="url(#r)">
                  <rect width="${labelWidth}" height="20" fill="${labelColor}"/>
                  <rect x="${labelWidth}" width="${valueWidth}" height="20" fill="${valueColor}"/>
                  <rect width="${totalWidth}" height="20" fill="url(#s)"/>
                </g>
                <g fill="#fff" text-anchor="middle" font-family="Verdana,Geneva,DejaVu Sans,sans-serif" text-rendering="geometricPrecision" font-size="11">
                  <text aria-hidden="true" x="${labelWidth / 2}" y="15" fill="#010101" fill-opacity=".3" transform="scale(1)" textLength="${labelWidth - paddingX}">${label}</text>
                  <text x="${labelWidth / 2}" y="14" transform="scale(1)" textLength="${labelWidth - paddingX}">${label}</text>
                  <text aria-hidden="true" x="${labelWidth + valueWidth / 2}" y="15" fill="#010101" fill-opacity=".3" transform="scale(1)" textLength="${valueWidth - paddingX}">${value}</text>
                  <text x="${labelWidth + valueWidth / 2}" y="14" transform="scale(1)" textLength="${valueWidth - paddingX}">${value}</text>
                </g>
              </svg>`;
        };

        // --- 数据获取与渲染 ---

        const parseColo = (traceText) => {
          const line = traceText.split('\n').find(line => line.startsWith('colo='));
          return line ? line.split('=')[1] : null;
        };
    
        const fetchDatacenterInfo = async (domain, coloElId, locElId) => {
          const coloEl = document.getElementById(coloElId);
          const locEl = document.getElementById(locElId);
          
          // 设置加载状态的徽章
          coloEl.innerHTML = createBadgeSVG('CF Colo', '...', '#555', '#9f9f9f');
          locEl.innerHTML = createBadgeSVG('Location', '...', '#555', '#9f9f9f');

          try {
            const traceResponse = await fetch(`https://${domain}/cdn-cgi/trace`);
            if (!traceResponse.ok) throw new Error('Trace fetch failed');
            const traceText = await traceResponse.text();
            const colo = parseColo(traceText);
    
            if (colo) {
              coloEl.innerHTML = createBadgeSVG('CF Colo', colo, '#555', '#33a3dc');
              try {
                const locResponse = await fetch(`https://iata.isteed.cc/zh/${colo}`);
                if (!locResponse.ok) throw new Error('Location fetch failed');
                const location = await locResponse.text();
                locEl.innerHTML = createBadgeSVG('Location', location || '未知', '#555', '#33a3dc');
              } catch (locError) {
                console.error(`Error fetching location for ${colo}:`, locError);
                locEl.innerHTML = createBadgeSVG('Location', '查询失败', '#555', '#e05d44');
              }
            } else {
              throw new Error('Colo not found in trace');
            }
          } catch (traceError) {
            console.error(`Error fetching trace for ${domain}:`, traceError);
            coloEl.innerHTML = createBadgeSVG('CF Colo', '获取失败', '#555', '#e05d44');
            locEl.innerHTML = createBadgeSVG('Location', 'N/A', '#555', '#e05d44');
          }
        };
    
        const initializeDatacenterInfo = () => {
          const sites = [
            { domain: 'oplist.022928.xyz', coloId: 'main-site-colo', locId: 'main-site-loc' },
            { domain: 'fast-r2.022928.xyz', coloId: 'r2-storage-colo', locId: 'r2-storage-loc' }
          ];
          sites.forEach(site => fetchDatacenterInfo(site.domain, site.coloId, site.locId));
        };
    
        const observer = new MutationObserver((mutations, obs) => {
          const footer = document.querySelector(".footer");
          if (footer) {
            const template = document.getElementById('datacenter-template');
            const datacenterContent = template.content.cloneNode(true);
            footer.parentNode.insertBefore(datacenterContent, footer.nextSibling);
            initializeDatacenterInfo();
            obs.disconnect();
          }
        });
    
        observer.observe(document.body, { childList: true, subtree: true });
      })();
    </script>
    
    <!-- END: 添加的代码结束 -->
  </body>
</html>
